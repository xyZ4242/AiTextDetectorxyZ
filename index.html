
<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>AI Detector â€” V7 (Stable Fix)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

<style>
  :root{ --bg: #05090c; --card-bg: rgba(20, 27, 34, 0.8); --text-main: #eef2f6; --text-muted: #8b9bb4; --primary: #3b82f6; --accent: #10b981; --danger: #f43f5e; --warning: #f59e0b; --border: rgba(255,255,255,0.08); --glass: rgba(255,255,255,0.02); }
  * { box-sizing: border-box; outline: none; }
  html { scroll-behavior: smooth; }
  body { margin: 0; background-color: var(--bg); background-image: radial-gradient(circle at 15% 50%, rgba(59, 130, 246, 0.08), transparent 25%), radial-gradient(circle at 85% 30%, rgba(16, 185, 129, 0.05), transparent 25%); color: var(--text-main); font-family: 'Plus Jakarta Sans', sans-serif; min-height: 100vh; display: flex; flex-direction: column; overflow-x: hidden; }
  .wrap { max-width: 1100px; margin: 40px auto; padding: 0 24px; width: 100%; display: flex; flex-direction: column; min-height: 90vh; }
  h1, .val, .logo { font-family: 'Outfit', sans-serif; }
  header { display: flex; align-items: center; gap: 20px; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 1px solid var(--border); }
  .logo { width: 56px; height: 56px; border-radius: 16px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
  .grid { display: grid; grid-template-columns: 1fr 440px; gap: 24px; align-items: start; flex-grow: 1; }
  .card { background: var(--card-bg); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 20px; padding: 24px; box-shadow: 0 4px 24px rgba(0,0,0,0.2); display: flex; flex-direction: column; transition: all 0.4s; position: relative; overflow: hidden; }
  
  .tabs { display: flex; gap: 8px; margin-bottom: 16px; border-bottom: 1px solid var(--border); padding-bottom: 12px; }
  .tab-btn { background: transparent; color: var(--text-muted); border: 1px solid transparent; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px; transition: all 0.2s; }
  .tab-btn:hover { color: var(--text-main); background: var(--glass); }
  .tab-btn.active { background: rgba(59, 130, 246, 0.1); color: var(--primary); font-weight: 600; }
  .input-panel { display: none; margin-bottom: 16px; }
  .input-panel.active { display: block; }
  .drop-zone { border: 2px dashed var(--border); border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; background: var(--glass); }
  .url-input { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 12px 16px; border-radius: 10px; color: var(--text-main); }
  
  .input-wrapper { position: relative; border-radius: 12px; overflow: hidden; }
  textarea { width: 100%; min-height: 380px; background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 12px; padding: 16px; color: inherit; font-family: 'Plus Jakarta Sans', monospace; font-size: 15px; line-height: 1.6; resize: vertical; display: block; }
  textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
  
  .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, transparent, var(--accent), transparent); box-shadow: 0 0 20px var(--accent); opacity: 0; pointer-events: none; z-index: 5; }
  .scanning .scan-line { animation: scanMove 1.5s cubic-bezier(0.45, 0, 0.55, 1) infinite; opacity: 1; }
  
  button { border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; font-family: 'Outfit', sans-serif; transition:0.3s; }
  #analyzeBtn { width: 100%; background: linear-gradient(135deg, var(--primary), #2563eb); color: white; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); margin-top:10px; font-size:15px; }
  #analyzeBtn:hover { transform: translateY(-2px); }
  
  .result-side { opacity: 0.5; filter: blur(3px); pointer-events: none; transition: 0.6s ease; }
  .result-side.active { opacity: 1; filter: blur(0); pointer-events: auto; border-color: rgba(59, 130, 246, 0.4); }
  .gauge-ring { width: 150px; height: 150px; border-radius: 50%; margin: 0 auto 20px; background: conic-gradient(var(--primary) 0deg, rgba(255,255,255,0.05) 0deg); display: flex; align-items: center; justify-content: center; transition: background 1s ease; }
  .gauge-inner { width: 120px; height: 120px; background: #0f151a; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  .val { font-size: 30px; font-weight: 700; background: linear-gradient(to bottom, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  
  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
  .stat-item { background: rgba(255,255,255,0.03); padding: 8px 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.05); }
  .stat-label { display: flex; justify-content: space-between; font-size: 10px; color: var(--text-muted); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
  .track { height: 5px; width: 100%; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
  .fill { height: 100%; width: 0%; background: var(--primary); border-radius: 10px; transition: width 1s cubic-bezier(0.22, 1, 0.36, 1); }
  .badge { text-align: center; font-size: 12px; font-weight: 700; padding: 6px 12px; border-radius: 20px; margin-bottom: 20px; border: 1px solid var(--border); display:inline-block; }
  .page-footer { margin-top: 40px; text-align: center; color: var(--text-muted); font-size: 13px; padding-top: 20px; border-top: 1px solid var(--border); }
  
  @keyframes scanMove { 0% { top: 0; } 100% { top: 100%; } }
  @media(max-width: 900px){ .grid { grid-template-columns: 1fr; gap: 32px; } }
</style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="logo">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10H12V2z"/><path d="M12 2a10 10 0 0 1 10 10h-10z" opacity="0.5"/></svg>
    </div>
    <div style="flex-grow:1">
      <h1>AI Text Detector</h1>
      <p style="font-size:13px;color:var(--text-muted)">V7 Stable: Auto-Sanitizer & Crash Protection</p>
    </div>
    <select id="lang" style="background:rgba(255,255,255,0.1);border:1px solid var(--border);color:white;padding:6px 12px;border-radius:8px"><option value="id">ðŸ‡®ðŸ‡© ID</option><option value="en">ðŸ‡ºðŸ‡¸ EN</option></select>
  </header>

  <div class="grid">
    <div class="card" style="z-index: 2;">
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('text')">Paste Text</button>
        <button class="tab-btn" onclick="switchTab('file')">Upload File</button>
        <button class="tab-btn" onclick="switchTab('url')">URL</button>
      </div>

      <div id="panel-file" class="input-panel">
        <div class="drop-zone" onclick="document.getElementById('fileInput').click()">
          <p>Klik untuk upload <b>PDF / DOCX / TXT</b></p>
          <input type="file" id="fileInput" accept=".txt,.pdf,.docx,.doc" style="display:none">
        </div>
      </div>

      <div id="panel-url" class="input-panel">
        <div style="display:flex; gap:10px">
          <input type="text" class="url-input" id="urlInput" placeholder="https://artikel.com">
          <button onclick="fetchUrl()" style="width:auto;margin:0;padding:0 20px;background:rgba(255,255,255,0.1)">Fetch</button>
        </div>
      </div>

      <div class="input-wrapper" id="inputWrapper">
        <div class="scan-line"></div>
        <textarea id="inputText" placeholder="Tempel teks di sini untuk dianalisis (Min. 30 kata)..."></textarea>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px">
        <button id="analyzeBtn">START SCANNING</button>
        <button onclick="el('inputText').value=''" style="width:80px;background:rgba(255,255,255,0.05);margin-top:10px">Clear</button>
      </div>
    </div>

    <div class="card result-side" id="resultCard">
      <div style="text-align:center"><span class="badge" id="statusBadge">WAITING</span></div>
      <div class="gauge-ring" id="gauge"><div class="gauge-inner"><div class="val" id="percent">0%</div></div></div>
      <div class="stats-grid" id="statsContainer"></div>
      <div style="margin-top:20px;text-align:center;font-size:13px;color:var(--text-muted);line-height:1.5;border-top:1px solid var(--border);padding-top:15px" id="explainText">Analisis mendalam akan muncul di sini.</div>
    </div>
  </div>

  <div class="page-footer"><span>Engineered by</span> <a href="#" class="credit-link" style="color:var(--text-main)">@savero</a></div>
</div>

<script>
/* === 1. UTILS & SANITIZER (ANTI-CRASH) === */
const el = (id) => document.getElementById(id);
const clamp = (x) => Math.max(0,Math.min(1,x));
const sd = (arr) => { if(arr.length<=1)return 0; const m=arr.reduce((a,b)=>a+b,0)/arr.length; return Math.sqrt(arr.map(x=>Math.pow(x-m,2)).reduce((a,b)=>a+b,0)/arr.length); };

// Sanitizer untuk karakter aneh dari copy-paste
function sanitizeText(t) {
  return t.replace(/[\u2018\u2019]/g, "'")
          .replace(/[\u201C\u201D]/g, '"')
          .replace(/\u2026/g, "...")
          .replace(/[\r\n]+/g, " ")
          .trim();
}

function tokenize(t){ 
  // Simple regex yang aman di semua browser
  return sanitizeText(t).toLowerCase().replace(/[^a-z0-9\s']/g, "").split(/\s+/).filter(Boolean);
}

function sentences(t){ 
  // Splitter aman tanpa Lookbehind yang bikin crash browser lama
  return sanitizeText(t).split(/[.?!]+\s+/).filter(s => s.trim().length > 2);
}

/* === 2. DATA & ENGINE === */
const DB = {
  id: {
    story: ["menghela napas","tersenyum kecil","terdiam sejenak","tak bergeming","entah bagaimana","seolah membawa","seolah-olah","perlahan namun pasti","tanpa ragu","sosok yang","cahaya remang","di sudut ruangan","tatapan mata","menyapu pandangan","perasaan aneh","angin berhembus","mematung","gemerlap","tak bisa dipungkiri","bergumam pelan","langkah kaki","hening sejenak","menatap nanar","degup jantung","nuansa yang","terpaku","seketika itu"],
    essay: ["kesimpulannya","penting untuk dicatat","dapat disimpulkan","sebagai model bahasa","pada dasarnya","secara keseluruhan","di sisi lain","selain itu","namun demikian","signifikan","ranah","tapestri","menyelami","sebuah bukti","landskap","konteks ini","adalah sebagai berikut","dalam hal ini","berkaitan dengan","menggarisbawahi","patut dipahami"],
    connectors: ["oleh karena itu", "akan tetapi", "dengan demikian", "sebagai hasilnya", "di samping itu", "sementara itu", "akibatnya", "selanjutnya"]
  },
  en: {
    story: ["shiver down", "remnant", "echoed", "a sense of", "unbeknownst", "flickered", "intertwined", "midst of", "loomed", "bustling", "nestled"],
    essay: ["in conclusion", "it is important to note", "furthermore", "moreover", "delve", "landscape", "testament", "realm", "tapestry", "underscores", "overall", "arguably", "vital role"],
    connectors: ["therefore", "however", "consequently", "furthermore", "nevertheless", "moreover", "meanwhile"]
  }
};

function analyze(text){
  const lang = el('lang').value;
  const cleanTxt = sanitizeText(text);
  const sent = sentences(cleanTxt);
  const words = tokenize(cleanTxt);
  const lower = cleanTxt.toLowerCase();

  // 1. Burstiness (Variasi Panjang Kalimat)
  const lens = sent.map(s => s.split(/\s+/).length);
  const dev = sd(lens);
  const burst = (dev > 3.5 && dev < 9.0) ? 0.8 : 0.25;

  // 2. Perplexity Proxy
  const unique = new Set(words).size;
  const perp = clamp(1 - Math.abs((unique / words.length) - 0.55) / 0.25);

  // 3. Repetition
  const wordCounts = {}; words.forEach(w => wordCounts[w] = (wordCounts[w]||0)+1);
  const repCount = Object.values(wordCounts).filter(c => c > 1).length;
  const rep = clamp((repCount / words.length) * 3.5);

  // 4. Hallmarks (Kunci Akurasi Cerita)
  const keys = [...DB[lang].story, ...DB[lang].essay];
  let hits = 0; 
  keys.forEach(k => { if(lower.includes(k)) hits += (k.includes(" ") ? 2 : 1); });
  const hall = clamp((hits / words.length) * 120);

  // 5. N-Gram
  const bi = []; for(let i=0; i<words.length-1; i++) bi.push(words[i]+" "+words[i+1]);
  const ngram = clamp(1 - ((new Set(bi).size / bi.length) - 0.6) / 0.35);

  // 6. Connectors
  let connHits = 0; DB[lang].connectors.forEach(c => { if(lower.includes(c)) connHits++; });
  const conn = clamp((connHits / words.length) * 150);

  // 7. Para Uniformity
  const paras = cleanTxt.split(/\n\s*\n/).filter(p=>p.trim().length>0);
  const para = paras.length < 2 ? 0.5 : clamp(1 - (sd(paras.map(p=>p.split(" ").length)) / 20));

  // 8. Complexity
  const commas = (cleanTxt.match(/,/g)||[]).length;
  const comp = clamp(commas / sent.length / 2.5);

  // 9. Readability
  const avgLen = words.reduce((a,b)=>a+b.length,0) / words.length;
  const read = (avgLen > 5.0 && avgLen < 6.5) ? 0.7 : 0.3;

  // 10. Emotion
  const emo = clamp(1 - ((cleanTxt.match(/!/g)||[]).length / cleanTxt.length * 100));

  // Weighting
  let w = { burst:0.1, perp:0.05, rep:0.05, hall:0.25, ngram:0.20, conn:0.1, para:0.1, comp:0.05, read:0.05, emo:0.05 };
  if(hall > 0.2) { w.hall = 0.45; w.ngram = 0.25; } // Adaptive Mode

  let score = burst*w.burst + perp*w.perp + rep*w.rep + hall*w.hall + ngram*w.ngram + conn*w.conn + para*w.para + comp*w.comp + read*w.read + emo*w.emo;
  
  if(hall > 0.5) score = Math.max(score, 0.88);
  if(score > 0.55) score += 0.15; if(score < 0.35) score -= 0.10;

  return { 
    total: clamp(score), 
    cats: { "Variasi Kalimat":burst, "Kekayaan Kata":perp, "Repetisi":rep, "Kata Khas AI":hall, "Pola Frasa":ngram, "Kata Sambung":conn, "Struktur Paragraf":para, "Kompleksitas":comp, "Readability":read, "Emosi Datar":emo } 
  };
}

/* === 3. UI INTERACTION === */
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

function switchTab(mode){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  document.querySelectorAll('.input-panel').forEach(p=>p.classList.remove('active'));
  if(mode==='file') el('panel-file').classList.add('active');
  if(mode==='url') el('panel-url').classList.add('active');
}

el('fileInput').addEventListener('change', async (e)=>{
  const f = e.target.files[0]; if(!f)return;
  el('inputText').value = "Reading file...";
  try {
    let txt = ""; const ext = f.name.split('.').pop().toLowerCase();
    if(ext==='txt') txt = await f.text();
    else if(ext==='pdf'){
      const d = await f.arrayBuffer(); const p = await pdfjsLib.getDocument({data:d}).promise;
      for(let i=1;i<=p.numPages;i++) txt += (await (await p.getPage(i)).getTextContent()).items.map(s=>s.str).join(' ')+"\n";
    }
    else if(ext.includes('doc')){ const r = await mammoth.extractRawText({arrayBuffer: await f.arrayBuffer()}); txt = r.value; }
    el('inputText').value = txt;
  } catch(e){ alert("Error reading file: " + e.message); }
});

async function fetchUrl(){
  const u = el('urlInput').value; if(!u)return;
  el('inputText').value = "Fetching URL...";
  try{
    const r = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(u)}`);
    const d = await r.json();
    const doc = new DOMParser().parseFromString(d.contents,'text/html');
    ['script','style','nav','footer'].forEach(t=>doc.querySelectorAll(t).forEach(e=>e.remove()));
    el('inputText').value = doc.body.innerText.trim();
  }catch(e){alert("Error fetching URL");}
}

el('analyzeBtn').onclick = () => {
  const txt = el('inputText').value.trim();
  if(txt.split(" ").length < 30){ alert("Teks terlalu pendek! Minimal 30 kata."); return; }

  // Animation
  el('inputWrapper').classList.add('scanning');
  el('analyzeBtn').innerHTML = "SCANNING...";
  el('resultCard').classList.remove('active');
  el('statsContainer').innerHTML = "";

  setTimeout(() => {
    try {
      // Calculation
      const res = analyze(txt);
      const pct = Math.round(res.total * 100);

      // Render UI
      animateValue(el('percent'), 0, pct, 1500);
      let color = pct > 70 ? 'var(--danger)' : (pct > 40 ? 'var(--warning)' : 'var(--accent)');
      el('gauge').style.background = `conic-gradient(${color} ${pct*3.6}deg, rgba(255,255,255,0.05) 0deg)`;
      el('statusBadge').innerText = pct > 70 ? "DOMINAN AI" : (pct > 40 ? "MERAGUKAN" : "INDIKASI MANUSIA");
      el('statusBadge').style.borderColor = color; el('statusBadge').style.color = color;
      
      el('explainText').innerHTML = pct > 70 
        ? `Terdeteksi <b style="color:${color}">pola robotik yang kuat</b>. Analisis menemukan penggunaan kata klise, variasi kalimat yang terlalu rapi, dan minim emosi.` 
        : `Struktur kalimat terlihat <b style="color:${color}">natural</b>. Penggunaan variasi kata dan struktur paragraf menunjukkan ciri khas tulisan manusia.`;

      let html = "";
      for(let [key, val] of Object.entries(res.cats)){
        const vPct = Math.round(val*100);
        const barCol = vPct > 50 ? 'var(--danger)' : (key==='Variasi Kalimat' ? 'var(--accent)' : 'linear-gradient(90deg, #3b82f6, #8b5cf6)');
        html += `<div class="stat-item"><div class="stat-label"><span>${key}</span><span>${vPct}%</span></div><div class="track"><div class="fill" style="width:${vPct}%; background:${barCol}"></div></div></div>`;
      }
      el('statsContainer').innerHTML = html;
      el('resultCard').classList.add('active');
      if(window.innerWidth < 900) el('resultCard').scrollIntoView({behavior:"smooth"});

    } catch(err) {
      alert("Terjadi error saat analisis: " + err.message);
    } finally {
      el('inputWrapper').classList.remove('scanning');
      el('analyzeBtn').innerHTML = "SCAN AGAIN";
    }
  }, 1200);
};

function animateValue(obj, start, end, duration) {
  let startTimestamp = null;
  const step = (timestamp) => {
    if (!startTimestamp) startTimestamp = timestamp;
    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
    obj.innerHTML = Math.floor(progress * (end - start) + start) + "%";
    if (progress < 1) window.requestAnimationFrame(step);
  };
  window.requestAnimationFrame(step);
}
</script>
</body>
</html>
